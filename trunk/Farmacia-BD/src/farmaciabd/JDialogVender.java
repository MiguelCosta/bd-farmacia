/*
 * To change this template, choose Tools | Templates
 * and open the template in the editor.
 */

/*
 * JDialogVender.java
 *
 * Created on 12/Jan/2011, 14:37:08
 */

package farmaciabd;

import java.awt.Component;
import java.awt.Dimension;
import java.awt.Frame;
import java.awt.Toolkit;
import java.sql.SQLException;
import java.util.GregorianCalendar;
import java.util.logging.Level;
import java.util.logging.Logger;
import javax.swing.DefaultListModel;
import javax.swing.JOptionPane;

/**
 *
 * @author Miguel
 */
public class JDialogVender extends java.awt.Dialog {

    DefaultListModel produtos_a_vender  = null;
    String nome_cliente                 = "";

    
    /** Creates new form JDialogVender */
    public JDialogVender(java.awt.Frame parent, boolean modal, String factura, String nomeCliente, DefaultListModel produtos_vender) {
        super(parent, modal);
        initComponents();
        centerOnScreen(this);

        jTextFieldVendaNum.setEditable(false);
        jTextFieldNomeCliente.setEditable(false);
        jTextFieldData.setEditable(false);

        jTextAreaFactura.setText(factura);
        jTextFieldNomeCliente.setText(nomeCliente);
        produtos_a_vender = produtos_vender;
        nome_cliente = nomeCliente;
        
        GregorianCalendar data  = new GregorianCalendar();
        String data_string      = "";
        String dia_semana       = String.valueOf(data.get(GregorianCalendar.DAY_OF_WEEK));
        dia_semana              = dia_semana_nome(dia_semana);
        String dia_mes          = String.valueOf(data.get(GregorianCalendar.DAY_OF_MONTH));
        String mes              = String.valueOf(data.get(GregorianCalendar.MONTH));
        mes                     = mes_nome(mes);
        String ano              = String.valueOf(data.get(GregorianCalendar.YEAR));

        data_string = data_string + dia_semana+", "+dia_mes+" de "+mes+" de "+ano;
        jTextFieldData.setText(data_string);



    }

    /** This method is called from within the constructor to
     * initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is
     * always regenerated by the Form Editor.
     */
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        jPanel1 = new javax.swing.JPanel();
        jLabelVendaNumero = new javax.swing.JLabel();
        jTextFieldVendaNum = new javax.swing.JTextField();
        jLabelNomeCliente = new javax.swing.JLabel();
        jTextFieldNomeCliente = new javax.swing.JTextField();
        jScrollPane1 = new javax.swing.JScrollPane();
        jTextAreaFactura = new javax.swing.JTextArea();
        jButtonEfectuarVenda = new javax.swing.JButton();
        jButtonCancelarVenda = new javax.swing.JButton();
        jLabelData = new javax.swing.JLabel();
        jTextFieldData = new javax.swing.JTextField();

        addWindowListener(new java.awt.event.WindowAdapter() {
            public void windowClosing(java.awt.event.WindowEvent evt) {
                closeDialog(evt);
            }
        });

        jLabelVendaNumero.setText("Venda n.º:");

        try {
            int numVenda = Negocio.proxNumeroVenda();
            jTextFieldVendaNum.setText(""+numVenda);
        }
        catch (SQLException ex){}

        jLabelNomeCliente.setText("Username:");

        jTextAreaFactura.setColumns(20);
        jTextAreaFactura.setRows(5);
        jTextAreaFactura.setBorder(null);
        jScrollPane1.setViewportView(jTextAreaFactura);

        jButtonEfectuarVenda.setText("Efectuar Venda");
        jButtonEfectuarVenda.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jButtonEfectuarVendaActionPerformed(evt);
            }
        });

        jButtonCancelarVenda.setText("Cancelar");
        jButtonCancelarVenda.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jButtonCancelarVendaActionPerformed(evt);
            }
        });

        jLabelData.setText("Data:");

        javax.swing.GroupLayout jPanel1Layout = new javax.swing.GroupLayout(jPanel1);
        jPanel1.setLayout(jPanel1Layout);
        jPanel1Layout.setHorizontalGroup(
            jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel1Layout.createSequentialGroup()
                .addContainerGap()
                .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(jScrollPane1, javax.swing.GroupLayout.DEFAULT_SIZE, 443, Short.MAX_VALUE)
                    .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, jPanel1Layout.createSequentialGroup()
                        .addComponent(jButtonCancelarVenda)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, 261, Short.MAX_VALUE)
                        .addComponent(jButtonEfectuarVenda))
                    .addGroup(jPanel1Layout.createSequentialGroup()
                        .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addComponent(jLabelNomeCliente)
                            .addComponent(jLabelVendaNumero)
                            .addComponent(jLabelData))
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addComponent(jTextFieldVendaNum, javax.swing.GroupLayout.PREFERRED_SIZE, 90, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addComponent(jTextFieldNomeCliente, javax.swing.GroupLayout.DEFAULT_SIZE, 387, Short.MAX_VALUE)
                            .addComponent(jTextFieldData, javax.swing.GroupLayout.DEFAULT_SIZE, 387, Short.MAX_VALUE))))
                .addContainerGap())
        );
        jPanel1Layout.setVerticalGroup(
            jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel1Layout.createSequentialGroup()
                .addContainerGap()
                .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabelVendaNumero)
                    .addComponent(jTextFieldVendaNum, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabelNomeCliente)
                    .addComponent(jTextFieldNomeCliente, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabelData)
                    .addComponent(jTextFieldData, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addGap(21, 21, 21)
                .addComponent(jScrollPane1, javax.swing.GroupLayout.PREFERRED_SIZE, 303, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, 28, Short.MAX_VALUE)
                .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jButtonEfectuarVenda)
                    .addComponent(jButtonCancelarVenda))
                .addContainerGap())
        );

        add(jPanel1, java.awt.BorderLayout.CENTER);

        pack();
    }// </editor-fold>//GEN-END:initComponents

    /** Closes the dialog */
    private void closeDialog(java.awt.event.WindowEvent evt) {//GEN-FIRST:event_closeDialog
        setVisible(false);
        dispose();
    }//GEN-LAST:event_closeDialog

    private void jButtonEfectuarVendaActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButtonEfectuarVendaActionPerformed
        
        int totalProdutosParaVender     = produtos_a_vender.getSize();
        String produto_todo             = "";
        String delims                   = "[ ]+";
        String produto                  = "";

        int decisao = JOptionPane.showConfirmDialog(new Frame(), "Tem a certeza que pretende efectuar a venda?", "Confirmar venda", JOptionPane.YES_NO_OPTION);

        if (decisao == 0) {
            try {

                String numero_venda         = jTextFieldVendaNum.getText();
                int i                       = 0;
                while (totalProdutosParaVender > i){
                    produto_todo            = produtos_a_vender.getElementAt(i).toString();
                    String[] id             = produto_todo.split(delims);
                    produto                 = id[0];
                    System.out.println(i);
                    //insere na tabla vendas
                    Negocio.registarVenda(produto, nome_cliente, numero_venda);

                    i++;
                }
            } catch (SQLException ex) {
                Logger.getLogger(JPrincipal.class.getName()).log(Level.SEVERE, null, ex);
            } catch (Exception ex) {
                Logger.getLogger(JDialogVender.class.getName()).log(Level.SEVERE, null, ex);
            }

            JOptionPane.showMessageDialog(new Frame(), "Venda registada com sucesso!", "Venda Efectuada",JOptionPane.NO_OPTION);
        }
        else
            JOptionPane.showMessageDialog(new Frame(), "Venda não efectuada!", "Venda Cancelada",JOptionPane.NO_OPTION);
    }//GEN-LAST:event_jButtonEfectuarVendaActionPerformed

    private void jButtonCancelarVendaActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButtonCancelarVendaActionPerformed
       JDialogVender.this.dispose();
    }//GEN-LAST:event_jButtonCancelarVendaActionPerformed

    /**
    * @param args the command line arguments
    */
    public static void main(String args[]) {
        java.awt.EventQueue.invokeLater(new Runnable() {
            public void run() {
                JDialogVender dialog = new JDialogVender(new java.awt.Frame(), true, "", "", null);
                dialog.addWindowListener(new java.awt.event.WindowAdapter() {
                    @Override
                    public void windowClosing(java.awt.event.WindowEvent e) {
                        System.exit(0);
                    }
                });
                dialog.setVisible(true);
            }
        });
    }


    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JButton jButtonCancelarVenda;
    private javax.swing.JButton jButtonEfectuarVenda;
    private javax.swing.JLabel jLabelData;
    private javax.swing.JLabel jLabelNomeCliente;
    private javax.swing.JLabel jLabelVendaNumero;
    private javax.swing.JPanel jPanel1;
    private javax.swing.JScrollPane jScrollPane1;
    private javax.swing.JTextArea jTextAreaFactura;
    private javax.swing.JTextField jTextFieldData;
    private javax.swing.JTextField jTextFieldNomeCliente;
    private javax.swing.JTextField jTextFieldVendaNum;
    // End of variables declaration//GEN-END:variables



    public static void centerOnScreen(final Component target) {
       if (target != null) {
           Dimension screenSize = Toolkit.getDefaultToolkit().getScreenSize();
           Dimension dialogSize = target.getSize();

           if (dialogSize.height > screenSize.height) {
               dialogSize.height = screenSize.height;
           }
           if (dialogSize.width > screenSize.width) {
               dialogSize.width = screenSize.width;
           }

           target.setLocation((screenSize.width - dialogSize.width) / 2,
                   (screenSize.height - dialogSize.height) / 2);
       }
   }


    public String dia_semana_nome (String numDia){
        int dia = Integer.parseInt(numDia);

        switch (dia) {
            case 1:
                return "Domingo";
            case 2:
                return "Segunda-Feira";
            case 3:
                return "Terça-Feira";
            case 4:
                return "Quarta-Feira";
            case 5:
                return "Quinta-Feira";
            case 6:
                return "Sexta-Feira";
            case 7:
                return "Sábado";
        }

        return "erro";
    }


    public String mes_nome (String numMes){
        int mes = Integer.parseInt(numMes);

        switch (mes) {
            case 0: return "Janeiro";
            case 1: return "Fevereiro";
            case 2: return "Março";
            case 3: return "Abril";
            case 4: return "Maio";
            case 5: return "Junho";
            case 6: return "Julho";
            case 7: return "Agosto";
            case 8: return "Setembro";
            case 9: return "Outubro";
            case 10: return "Novembro";
            case 11: return "Dezembro";
        }

        return "erro";
    }

}
